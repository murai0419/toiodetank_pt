<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>toioãƒ•ã‚§ãƒ³ã‚·ãƒ³ã‚°å¯¾æˆ¦</title>
  <script src="https://unpkg.com/toio.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
    .controls { display: flex; justify-content: space-around; margin-top: 20px; }
    button { padding: 10px 20px; margin: 5px; }
    .score { font-size: 1.5em; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>ğŸ—¡ï¸ toio ãƒ•ã‚§ãƒ³ã‚·ãƒ³ã‚°ãƒãƒˆãƒ«</h1>
  <button onclick="connectCube(1)">ğŸ”— Player 1 ã‚­ãƒ¥ãƒ¼ãƒ–æ¥ç¶š</button>
  <button onclick="connectCube(2)">ğŸ”— Player 2 ã‚­ãƒ¥ãƒ¼ãƒ–æ¥ç¶š</button>

  <div class="controls">
    <div>
      <h3>Player 1ï¼ˆWASDï¼‰</h3>
      <button onclick="moveCube(1, 'forward')">â¬†ï¸</button><br/>
      <button onclick="moveCube(1, 'left')">â¬…ï¸</button>
      <button onclick="moveCube(1, 'back')">â¬‡ï¸</button>
      <button onclick="moveCube(1, 'right')">â¡ï¸</button>
    </div>
    <div>
      <h3>Player 2ï¼ˆçŸ¢å°ã‚­ãƒ¼ï¼‰</h3>
      <button onclick="moveCube(2, 'forward')">â¬†ï¸</button><br/>
      <button onclick="moveCube(2, 'left')">â¬…ï¸</button>
      <button onclick="moveCube(2, 'back')">â¬‡ï¸</button>
      <button onclick="moveCube(2, 'right')">â¡ï¸</button>
    </div>
  </div>

  <div>
    <h2>å¯©åˆ¤ï¼šå‹è€…ã‚’é¸ã‚“ã§ãã ã•ã„</h2>
    <button onclick="judgeWinner(1)">ğŸ† Player 1 å‹åˆ©</button>
    <button onclick="judgeWinner(2)">ğŸ† Player 2 å‹åˆ©</button>
    <div class="score" id="scoreBoard">ã‚¹ã‚³ã‚¢: 0 - 0</div>
    <div id="result"></div>
  </div>

  <script>
    let cube1 = null, cube2 = null;
    let score = [0, 0], round = 0, maxRounds = 3;

    async function connectCube(num) {
      const cube = new toio.cube.ToioCube();
      await cube.connectNew();
      alert(`Player ${num} ã‚­ãƒ¥ãƒ¼ãƒ–æ¥ç¶šå®Œäº†`);
      if (num === 1) cube1 = cube;
      else cube2 = cube;
    }

    function moveCube(player, dir) {
      const cube = player === 1 ? cube1 : cube2;
      if (!cube) return;

      let speed = 50, duration = 300;
      let l = 0, r = 0;
      switch (dir) {
        case 'forward': l = r = speed; break;
        case 'back': l = r = -speed; break;
        case 'left': l = -speed; r = speed; break;
        case 'right': l = speed; r = -speed; break;
      }
      cube.move(l, r, duration);
    }

    document.addEventListener("keydown", (e) => {
      switch (e.key) {
        case 'w': moveCube(1, 'forward'); break;
        case 's': moveCube(1, 'back'); break;
        case 'a': moveCube(1, 'left'); break;
        case 'd': moveCube(1, 'right'); break;
        case 'ArrowUp': moveCube(2, 'forward'); break;
        case 'ArrowDown': moveCube(2, 'back'); break;
        case 'ArrowLeft': moveCube(2, 'left'); break;
        case 'ArrowRight': moveCube(2, 'right'); break;
      }
    });

    function judgeWinner(winner) {
      if (round >= maxRounds) {
        alert("ã™ã§ã«è©¦åˆçµ‚äº†ã—ã¦ã„ã¾ã™");
        return;
      }

      score[winner - 1]++;
      round++;
      document.getElementById("scoreBoard").textContent = `ã‚¹ã‚³ã‚¢: ${score[0]} - ${score[1]}`;

      if (round >= maxRounds) {
        let result = score[0] === score[1] ? "ğŸ¤ å¼•ãåˆ†ã‘ï¼" :
                     score[0] > score[1] ? "ğŸ† Player 1 ã®å‹åˆ©ï¼" : "ğŸ† Player 2 ã®å‹åˆ©ï¼";
        document.getElementById("result").textContent = `çµæœï¼š${result}`;
      }
    }
  </script>
</body>
</html>